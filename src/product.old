<?php 
defined('C5_EXECUTE') or die("Access Denied.");
$this->inc('elements/header.php');
$form = loader::helper('form');
global $u;
$logged_in = $u->isLoggedIn();
$page_id = $c->getCollectionId();
//user data
$ownerID = $c->getCollectionUserID();
$ui = UserInfo::getByID($ownerID);
$user_first_name = $ui->getAttribute('first_name');
$user_sir_name = $ui->getAttribute('sir_name');  
//advertenties tellen
Loader::model('page_list'); 
$upl = new PageList();
$upl->filterByCollectionTypeHandle('product');
$upl->filterByUserID($ownerID);		
$upages = $pages = $upl->get($itemsToGet = 2, $offset = 0) ;	//we willen weten of er meer als 1 advertentie is
$hasMoreThanOneAdd = false;
if (count($upages) > 1) {
$hasMoreThanOneAdd = true;	
}
//privacy
$show_email = $ui->getAttribute('email_secret');
$show_phone = $ui->getAttribute('phone_secret');
$user_birth = new DateTime($ui->getAttribute('user_birth'));
$user_image = $ui->getAttribute('profile_image');
$user_address_city = $ui->getAttribute('address_city');	
$gender = $ui->getAttribute('gender');
$user_education_level = $ui->getAttribute('education');
$user_about = $ui->getAttribute('user_about');	
$user_specialities	= $ui->getAttribute('user_specialities');	
$user_mail = $ui->getUserEmail();	
$user_facebook = $ui->getAttribute('facebook');	
//company data
$user_company_name = $ui->getAttribute('company_name');
$user_company_kvk = $ui->getAttribute('company_kvk');
$user_company_type = $ui->getAttribute('company_type');
$user_company_type = $ui->getAttribute('company_type');
$user_company_nr_people = $ui->getAttribute('company_nr_people');
$user_company_logo = $ui->getAttribute('company_logo');								 
//add data
$description = $c->getAttribute('product_long_description');
$website = $c->getAttribute('product_website_url');
$youtube = $c->getAttribute('product_youtube');
$product_city = $c->getAttribute('address_city');
$product_street = $c->getAttribute('address_street_name').' '.$c->getAttribute('address_street_nr');
$product_zip = $c->getAttribute('address_zip');	
$product_lat = $c->getCollectionAttributeValue('product_location_long');
$product_long = $c->getCollectionAttributeValue('product_location_lat');
$product_location_lat_long = $product_long.','.$product_lat;
$product_diploma = $c->getAttribute('product_diploma');		
$product_education_level_custom = $c->getAttribute('product_education_level_custom');
$product_career_level = $c->getAttribute('product_career_level');
$product_career_level_custom = $c->getAttribute('product_career_level_custom');


$price_negotiation = $c->getAttribute('product_price_negotiation');
$price_value = $c->getAttribute('product_price_value');
$price_type = $c->getAttribute('product_price_setting');		
$date = date('d/m/Y', strtotime($c->getCollectionDatePublic()));
//beschikbaarheid
$selected_days = $c->getAttribute('product_days');	
$ak = CollectionAttributeKey::getByHandle('product_days');
$satc = new SelectAttributeTypeController(AttributeType::getByHandle('select'));
$satc->setAttributeKey($ak);
$all_days = $satc->getOptions();
foreach ($selected_days as $day) {
	$days[] = $day->value;
}
//contactvoorkeur
$contact_pref = $c->getAttribute('product_contact_prefs');
$product_contact_name = $user_first_name.' '.$user_sir_name; //aangepast na drama over namen bij advertenties
//helper favorieten
loader::helper ('favorites');
$fh = new FavoritesHelper();
//beveiliging
if ($_GET['favorite'] && $_GET['favorite'] == $page_id ) {
	$fh->set_favs($page_id);
}
?>

<div class="container inner-xxs">
  <div class="row">
    <div class="col-md-12">
      <?php  $this->inc('elements/breadcrumbs.php'); ?>
    </div>
    <div class="col-sm-8">
      <?php 
	if ($_GET["method"]) {
		$info_tab = null;
		$review_tab = 'active';
	} else {
		$info_tab = 'active';
		$review_tab = null;
	}
	
	?>
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="<?php echo $info_tab;?>"><a href="#main" aria-controls="main" role="tab" data-toggle="tab">Informatie</a></li>
        <li role="presentation"><a href="#props" aria-controls="props" role="tab" data-toggle="tab">Kenmerken</a></li>
        <li role="presentation"><a href="#calendar" aria-controls="calendar" role="tab" data-toggle="tab">Beschikbaarheid</a></li>
        <li role="presentation" class="<?php echo $review_tab;?>"><a id="tab-review" href="#review" aria-controls="review" role="tab" data-toggle="tab">Reviews</a></li>
        <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profiel</a></li>
      </ul>
      
      <!-- Tab panes -->
      <div class="tab-content tab-content-bordered outer-bottom-xs">
        <div role="tabpanel" class="tab-pane <?php echo $info_tab;?>" id="main">
          <div class="row">
            <?php
	$ai = new AddImagesHelper();
	$ih = loader::helper('image');
	$image_attributes = $ai->attrHandles;
	$has_images = false;
	foreach ($image_attributes as $image_attribute) {	
	
		if ($c->getAttribute($image_attribute)){
			$product_thumb = $ih->getThumbnail($c->getAttribute($image_attribute), 660, 999); 
			$has_images = true;			
			echo '<div class="col-sm-2"><a href="'.$product_thumb->src.'" data-toggle="lightbox" data-gallery="multiimages" data-title="'.$c->getCollectionName().'" class="product-thumb"><img src="'.$product_thumb->src.'" class="img-responsive" /></a></div>';
		} 
	}
	if (!$has_images) {
		echo '<p class="col-md-12">Deze advertentie bevat geen afbeeldingen</p>';
	} 
	
	?>
          </div>
          <h3>Talent: <?php echo $c->getCollectionName();?></h3>
          <div class="alert alert-info">
            <p>Salarisniveau: €<?php echo $price_value;?> <?php echo $price_type;?></p>
          </div>
          <?php echo $c->getAttribute('product_long_description');?>
          <?php if ($youtube) :	
		  
			  //schoonmaken youtube url
			  //http:// of https:// worden verwijderd uit het url
			  //watch?v= wordt vervangen door embed/
			    
			  $original = array("watch?v=", "https://", "http://");
			  $replacement   = array("embed/", "", "");
			  $youtube_url = str_replace($original, $replacement, $youtube);
			?>
          <div class="user-video">
            <iframe width="560" height="315" src="https://<?php echo $youtube_url;?>" frameborder="0" allowfullscreen></iframe>
          </div>
          <?php endif; ?>
          <?php  if ($website) : ?>
          <p><a class="btn" href="<?php echo $website;?>" title="Bezoek de website van <?php echo $product_contact_name;?>" target="_blank"><i class="icon-globe"></i> Bezoek de website van <?php echo $product_contact_name;?></a></p>
          <?php endif;?>
        </div>
        <div role="tabpanel" class="tab-pane" id="props">
          <h3 class="orange"> Advertentie kenmerken: </h3>
          <dl class="product-meta">
            <dd>Salarisniveau: </dd>
            <dt>€<?php echo $price_value;?> <?php echo $price_type;?></dt>
            <dd>Geboortedatum:</dd>
            <dt> <?php echo $user_birth->format('d-m-Y');?></dt>
            <dd>Dimploma:</dd>
            <dt>
              <?php if ($product_diploma) { ?>
              Ja
              <?php } else {?>
              Nee
              <?php } ?>
            </dt>
            <dd>Opleidingsniveau:</dd>
            <dt>
              <?php if ($user_education_level) { echo $user_education_level; }?>
               <?php if ($product_education_level_custom) :?>
               <br />
          	<?php echo $product_education_level_custom;?>
          <?php endif;?>
            </dt>
            <dd>Carrièreniveau:</dd>
            <dt>
              <?php if ($product_career_level) { echo $product_career_level; } else { echo 'Onbekend';}?>
            </dt>
            <dd>Locatie:</dd>
            <dt> <?php echo $product_city; ?> <a class="aqua" href="#MapModal" data-toggle="modal">(Bekijk op kaart)</a></dt> 
          </dl>
        </div>
        <div role="tabpanel" class="tab-pane" id="calendar">
          <table class="table table-calendar">
            <thead>
              <tr>
                <th></th>
                <th>Ma</th>
                <th>Di</th>
                <th>Woe</th>
                <th>Do</th>
                <th>Vr</th>
                <th>Za</th>
                <th>Zo</th>
              </tr>
            </thead>
            <tbody>
              <?php 
            $count = 1;
            foreach ($all_days as $options) {
				switch ($count) {
			case 1:
				echo '<tr><th>Ochtend</th>';
				break;
			case 8:
				echo '<tr><th>Middag</th>';
				break;
			case 15:
				echo '<tr><th>Avond</th>';
				break;
			case 22:
				echo '<tr><th>Nacht</th>';
				break;
				}
				if (in_array ($options->value, $days)) {
				echo  '<td class="green"><i class="icon-check"></i></td>';
				} else {
				echo  '<td></td>';
				}
				$count ++;
            }
            ?>
            </tbody>
          </table>
        </div>
        <div role="tabpanel" class="tab-pane <?php echo $review_tab;?>" id="review">
          <?php
			$a = new GlobalArea('Reviews');
			$a->display();				
			?>
        </div>
        <div role="tabpanel" class="tab-pane" id="profile">
          <ul class="list-inline">
            <?php if ($user_image || $user_company_logo) {
		$ih = loader::helper('image');
		}
		if ($user_company_logo) {			
		$user_thumb = $ih->getThumbnail($user_company_logo, 75, 9999,false); } 
		else {
		$user_thumb = $ih->getThumbnail($user_image, 75, 9999,false);	
		}?>
            <li><img class="img-rounded" src="<?php echo $user_thumb->src ?>" alt="<?php echo $product_contact_name; ?>" /></li>
            <li>
              <?php if ($user_company_name) { echo '<strong>Naam: </strong>'.$user_company_name; } else {
           echo '<strong>Naam: </strong>'.$product_contact_name;} ?>
            </li>
          </ul>
          <p> <strong>Specialisme: </strong>
            <?php if ($user_specialities) {?>
            <?php echo $user_specialities;} else { echo 'Geen informatie opgegeven'; }?></p>
          <strong>Beoordeling:</strong> <a class="aqua" id="tab-review" href="#review" aria-controls="review" role="tab" data-toggle="tab"> Bekijk de reviews van deze dienstverlener</a>
          <hr />
          <p><strong>Over deze dienstverlener</strong></p>
          <?php if ($user_about) {?>
          <p><?php echo $user_about;} else { echo 'Geen informatie opgegeven'; }?></p>
          <?php if ($user_company_kvk) {
		   echo '<p><strong>KVK:</strong> '.$user_company_kvk.'</p>';
		   }?>
          <?php if ($user_company_nr_people) {
		   echo '<p><strong>Aantal werknemers:</strong> '.$user_company_nr_people.'</p>';
		   }?>
          <?php if ($user_company_type) {
		   echo '<p><strong>Bedrijfsvorm:</strong> '.$user_company_type.'</p>';
		   }?>
          <p>
            <?php if ($website) :?>
            <a style="border:none;" class="aqua" href="<?php echo $website;?>"><i class="icon-globe"></i> Bezoek de website van <?php echo $product_contact_name;?></a>
            <?php endif;?>
            <?php if ($user_facebook) :?>
            <a style="border:none;" class="aqua" href="<?php echo $user_facebook;?>"><i class="icon-facebook"></i> Bezoek de Facebook pagina <?php echo $product_contact_name;?></a>
            <?php endif;?>
          </p>
        </div>
      </div>
	  <h4><a class="aqua" href="<?php echo $this->url('/gebruiker');?>?gebruiker=<?php echo $ownerID;?>&tab=advertenties"><i class="icon-plus"></i> Bekijk alle advertenties van <?php echo $product_contact_name; ?> &raquo;</a></h4>
      <?php
			$a = new GlobalArea('Product Midden');
			$a->display();				
			?>
            <?php if($hasMoreThanOneAdd) :?>
          
        <?php endif;?>  
      </div>
    <div class="col-sm-4">
      <div class="outer-bottom-xs">
        <?php 	
	if ($logged_in && !in_array($page_id,$fh->get_favs())) {?>
        <form method="get">
          <button type="submit" class="btn btn-block btn-red" style="margin-top:0;"><i class="icon-heart-1"></i> Bewaar</button>
          <?php print $form->hidden('favorite',$page_id);?>
        </form>
        <?php ;} elseif ($logged_in) { ?>
        <form method="get">
          <p class="red"><small><i class="icon-heart-1"></i> Opgeslagen als favoriet <a class="aqua" href="<?php echo $this->url('mijn_fgn/favorieten');?>" title="Favorieten beheren">(Favorieten beheren)</a></small></p>
        </form>
        <?php ;} else { ?>
        <a class="aqua" href="<?php echo $this->url('/login/forward/'.$page_id);?>"><small><i class="icon-lock"></i> Login om op te slaan</small></a>
        <button class="disabled btn btn-block btn-red"><i class="icon-heart-1"></i> Bewaar</button>
        <?php ;} ?>
      </div>
      <div class="bordered inner-xxs inner-left-xxs inner-right-xxs outer-bottom-xs">
        <h3>
          <?php if ($product_diploma) :?>
          <i class="blue icon-graduation-cap"></i>
          <?php endif;?>         
          <?php echo $product_contact_name; ?>
          <?php if ($user_image) {
		$ih = loader::helper('image');
		$user_thumb = $ih->getThumbnail($user_image, 50, 50,true); 	?>
          <img class="img-circle pull-right" src="<?php echo $user_thumb->src ?>" alt="<?php echo $product_contact_name; ?>" />
          <?php ;}?>
        </h3>
        <ul class="list-unstyled">
          <li>
            <?php if ($user_mail) { ?>
            <a class="aqua" href="mailto:<?php echo $user_mail;?>"><i class="icon-mail-1"></i> <?php echo $user_mail;?></a>
            <?php } else { ?>
            <i class="icon-mail-1"></i> <i>(E-mail is geheim)</i>
            <?php ;} ?>
          </li>
          <li>
		  
            <?php if ($c->getAttribute('product_phone_nr')) {?>
            <i class="icon-mobile"></i> <?php echo $c->getAttribute('product_phone_nr');?>
            <?php } else {;?>
            <i class="icon-mobile"></i> <i>(Telefoonnummer is geheim of onbekend)</i>
            <?php ;} ?>
          </li>
          <li><i class="icon-location-1"></i> <?php echo $product_city;?></li>
          <?php if ($website) :?>
          <li><a class="aqua" href="<?php echo $website;?>"><i class="icon-globe"></i> Bezoek de website</a></li>
          <?php endif;?>
           <?php if ($user_facebook) :?>
           <li> <a class="aqua" href="<?php echo $user_facebook;?>"><i class="icon-facebook"></i> Bezoek de Facebook pagina</a></li>
            <?php endif;?>
          
        </ul><?php if($hasMoreThanOneAdd) :?>
        <a class="aqua small" href="<?php echo $this->url('/gebruiker');?>?gebruiker=<?php echo $ownerID;?>&tab=advertenties"><i class="icon-plus"></i> Bekijk alle advertenties van <?php echo $product_contact_name; ?> &raquo;</a> <?php endif;?> </div>
      <?php
			$a = new GlobalArea('Product Sidebar');
			$a->display();				
			?>
    </div>
  </div>
</div>
<div class="modal fade" id="MapModal">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title"><?php echo $c->getCollectionName();?></h4>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <div id="map-canvas"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal">Sluit</button>
      </div>
    </div>
    <!-- /.modal-content --> 
  </div>
  <!-- /.modal-dialog --> 
</div>
<script src="<?php echo $this->getThemePath()?>/assets/js/ekko-lightbox.min.js"></script> 
<script type="text/javascript" src="http://maps.google.com/maps/api/js"></script> <!-- /.modal --> 
<script>
$(document).ready(function () {
	//$("#rating-average .ccm-rating").clone().insertAfter("h1");
	
	
	function appendTextRating (rating) {
		$('#rating-average').append('<div class="text-rating">('+rating+')</div>');
	}
	var ratingValue = $('#rating-average .rating-star-on').length;
	
	switch(ratingValue) {
	case 0:appendTextRating('Nog niet beoordeeld');
		break;
    case 1:
        appendTextRating('Slecht');
        break;
    case 2:
        appendTextRating('Matig');
        break;
	case 3:
        appendTextRating('Goed');
        break;	
	case 4:
        appendTextRating('Uitstekend');
        break;
	case 5:
        appendTextRating('Uitmuntend');
        break;	
    
} 
	
	$(document).delegate('*[data-toggle="lightbox"]', 'click', function(event) {
		event.preventDefault();
		$(this).ekkoLightbox();
	});
	var map;        
	var myCenter=new google.maps.LatLng(<?php echo $product_location_lat_long; ?>);
	var marker=new google.maps.Marker({
		position:myCenter
	});
	
	function initialize() {
	  var mapProp = {
		  center:myCenter,
		  zoom: 14,
		  draggable: false,
		  scrollwheel: false,
		  mapTypeId:google.maps.MapTypeId.ROADMAP
	  };
	  
	  map=new google.maps.Map(document.getElementById("map-canvas"),mapProp);
	  marker.setMap(map);
		
	  google.maps.event.addListener(marker, 'click', function() {
		  
		infowindow.setContent(contentString);
		infowindow.open(map, marker);
		
	  }); 
	};
	google.maps.event.addDomListener(window, 'load', initialize);
	google.maps.event.addDomListener(window, "resize", resizingMap());
	
	$('#MapModal').on('show.bs.modal', function() {  
	   resizeMap();
	})
	
	function resizeMap() {
	   if(typeof map =="undefined") return;
	   setTimeout( function(){resizingMap();} , 400);
	}
	
	function resizingMap() {
	   if(typeof map =="undefined") return;
	   var center = map.getCenter();
	   google.maps.event.trigger(map, "resize");
	   map.setCenter(center); 
	}
	
	$("#ccm-rating-rating div:nth-child(3) > a").attr("title", "Slecht");
	$("#ccm-rating-rating div:nth-child(4) > a").attr("title", "Matig");
	$("#ccm-rating-rating div:nth-child(5) > a").attr("title", "Voldoende");
	$("#ccm-rating-rating div:nth-child(6) > a").attr("title", "Goed");
	$("#ccm-rating-rating div:nth-child(7) > a").attr("title", "Uitmuntend");
	
});
</script>
<?php  $this->inc('elements/footer.php'); ?>
